From 34e771af53768a5e6d291740d9c4f07e3c59b7b1 Mon Sep 17 00:00:00 2001
From: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
Date: Fri, 17 Apr 2020 21:39:14 +0100
Subject: [PATCH 2/3] trace-cmd: Fix build with gcc-10

commit 0ea3f5c42ffad95ef55c8b269649a1135e5d02f9 upstream

The build fails while building with gcc-10 with the error:
multiple definition of `common_type_field'

Rename the field in trace-hist.c and trace-mem.c to satisfy gcc-10.

Link: http://lore.kernel.org/linux-trace-devel/20200417203914.26358-1-sudipm.mukherjee@gmail.com

Bug-Link: https://bugs.debian.org/957879
Signed-off-by: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
Signed-off-by: Steven Rostedt (VMware) <rostedt@goodmis.org>
Signed-off-by: Sudip Mukherjee <sudipm.mukherjee@gmail.com>
---
 tracecmd/trace-hist.c | 8 ++++----
 tracecmd/trace-mem.c  | 8 ++++----
 2 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/tracecmd/trace-hist.c b/tracecmd/trace-hist.c
index 2e30d02..e0e7c47 100644
--- a/tracecmd/trace-hist.c
+++ b/tracecmd/trace-hist.c
@@ -27,7 +27,7 @@ static int kernel_stack_type;
 
 static int long_size;
 
-static struct tep_format_field *common_type_field;
+static struct tep_format_field *common_type_hist;
 static struct tep_format_field *common_pid_field;
 static struct tep_format_field *sched_wakeup_comm_field;
 static struct tep_format_field *sched_wakeup_new_comm_field;
@@ -568,7 +568,7 @@ process_record(struct tep_handle *pevent, struct tep_record *record)
 	unsigned long long val;
 	int type;
 
-	tep_read_number_field(common_type_field, record->data, &val);
+	tep_read_number_field(common_type_hist, record->data, &val);
 	type = val;
 
 	if (type == function_type)
@@ -956,8 +956,8 @@ static void do_trace_hist(struct tracecmd_input *handle)
 
 	long_size = tracecmd_long_size(handle);
 
-	common_type_field = tep_find_common_field(event, "common_type");
-	if (!common_type_field)
+	common_type_hist = tep_find_common_field(event, "common_type");
+	if (!common_type_hist)
 		die("Can't find a 'type' field?");
 
 	common_pid_field = tep_find_common_field(event, "common_pid");
diff --git a/tracecmd/trace-mem.c b/tracecmd/trace-mem.c
index 25bdbae..f23f0a3 100644
--- a/tracecmd/trace-mem.c
+++ b/tracecmd/trace-mem.c
@@ -30,7 +30,7 @@ static int kmem_cache_alloc_type;
 static int kmem_cache_alloc_node_type;
 static int kmem_cache_free_type;
 
-static struct tep_format_field *common_type_field;
+static struct tep_format_field *common_type_mem;
 
 static struct tep_format_field *kmalloc_callsite_field;
 static struct tep_format_field *kmalloc_bytes_req_field;
@@ -369,7 +369,7 @@ process_record(struct tep_handle *pevent, struct tep_record *record)
 	unsigned long long val;
 	int type;
 
-	tep_read_number_field(common_type_field, record->data, &val);
+	tep_read_number_field(common_type_mem, record->data, &val);
 	type = val;
 
 	if (type == kmalloc_type)
@@ -490,8 +490,8 @@ static void do_trace_mem(struct tracecmd_input *handle)
 	ret = tep_data_type(pevent, record);
 	event = tep_find_event(pevent, ret);
 
-	common_type_field = tep_find_common_field(event, "common_type");
-	if (!common_type_field)
+	common_type_mem = tep_find_common_field(event, "common_type");
+	if (!common_type_mem)
 		die("Can't find a 'type' field?");
 
 	update_kmalloc(pevent);
-- 
2.20.1

